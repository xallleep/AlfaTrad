<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bitcoin Predictor Pro</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Roboto+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-bg: #0a0e17;
            --card-bg: #131a2d;
            --accent-green: #00C853;
            --accent-red: #FF1744;
            --accent-blue: #2962FF;
            --accent-orange: #FF9800;
        }
        
        body {
            background: var(--primary-bg);
            color: #ffffff;
            font-family: 'Roboto Mono', monospace;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
        }
        
        .terminal-header {
            background: linear-gradient(135deg, #1a237e 0%, #0d47a1 100%);
            padding: 15px 0;
            border-bottom: 1px solid #2962FF;
        }
        
        .app-title {
            font-family: 'Orbitron', sans-serif;
            font-weight: 700;
            font-size: 2.5rem;
            background: linear-gradient(45deg, #00C853, #2962FF, #FF9800);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(41, 98, 255, 0.3);
        }
        
        .market-data-bar {
            background: rgba(19, 26, 45, 0.95);
            padding: 10px 0;
            border-bottom: 1px solid #1e88e5;
        }
        
        .price-display {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
        }
        
        .positive { color: var(--accent-green); }
        .negative { color: var(--accent-red); }
        
        .signal-buy {
            background: linear-gradient(135deg, var(--accent-green) 0%, #00E676 100%);
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 0 20px rgba(0, 200, 83, 0.4);
            border: 2px solid #00E676;
        }
        
        .signal-sell {
            background: linear-gradient(135deg, var(--accent-red) 0%, #F50057 100%);
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 0 20px rgba(255, 23, 68, 0.4);
            border: 2px solid #F50057;
        }
        
        .signal-neutral {
            background: linear-gradient(135deg, #78909C 0%, #B0BEC5 100%);
            color: white;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.2rem;
            box-shadow: 0 0 20px rgba(120, 144, 156, 0.4);
            border: 2px solid #B0BEC5;
        }
        
        .chart-container {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            border: 1px solid #1e88e5;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .confidence-meter {
            height: 20px;
            background: #2c3e50;
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }
        
        .confidence-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
        }
        
        .confidence-buy { background: linear-gradient(90deg, #00C853, #00E676); }
        .confidence-sell { background: linear-gradient(90deg, #FF1744, #F50057); }
        .confidence-neutral { background: linear-gradient(90deg, #78909C, #B0BEC5); }
        
        .refresh-btn {
            background: linear-gradient(135deg, #2962FF 0%, #1A237E 100%);
            border: none;
            border-radius: 20px;
            padding: 10px 20px;
            color: white;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(41, 98, 255, 0.4);
        }
        
        .analysis-text {
            background: rgba(41, 98, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #2962FF;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="terminal-header">
        <div class="container">
            <div class="text-center">
                <h1 class="app-title">BITCOIN PREDICTOR PRO</h1>
                <p class="text-light">Gráfico Profissional • Previsão em Tempo Real • Análise Técnica</p>
            </div>
        </div>
    </div>

    <div class="market-data-bar">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-4 text-center">
                    <div class="price-display">
                        <span id="currentPrice">--</span>
                        <span id="priceChange"></span>
                    </div>
                </div>
                <div class="col-md-4 text-center">
                    <div id="tradingSignal" class="signal-neutral">CARREGANDO...</div>
                </div>
                <div class="col-md-4 text-center">
                    <button onclick="loadData()" class="refresh-btn">
                        <i class="fas fa-sync-alt"></i> ATUALIZAR
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-4">
        <div class="row">
            <div class="col-lg-9">
                <div class="chart-container">
                    <div id="candleChart" style="height: 600px;"></div>
                </div>
            </div>
            
            <div class="col-lg-3">
                <div class="chart-container">
                    <h5><i class="fas fa-brain"></i> CONFIANÇA DA PREVISÃO</h5>
                    <div class="confidence-meter">
                        <div id="confidenceBar" class="confidence-fill" style="width: 50%;"></div>
                    </div>
                    <div id="confidenceText" class="text-center">50%</div>
                    
                    <div class="analysis-text">
                        <h6><i class="fas fa-chart-line"></i> ANÁLISE</h6>
                        <p id="analysisText">Analisando dados de mercado...</p>
                    </div>
                    
                    <div class="text-center">
                        <h6><i class="fas fa-info-circle"></i> INFORMAÇÕES</h6>
                        <p>RSI: <span id="rsiValue">--</span></p>
                        <p>Última atualização: <br><span id="lastUpdate">--</span></p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-3">
            <div class="col-12">
                <div class="chart-container">
                    <div id="rsiChart" style="height: 250px;"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function loadData() {
            document.getElementById('tradingSignal').innerHTML = '<i class="fas fa-spinner fa-spin"></i> ATUALIZANDO...';
            
            fetch('/api/btc-data')
                .then(response => response.json())
                .then(data => {
                    if (data.status === 'success') {
                        updateDisplay(data);
                    }
                })
                .catch(error => {
                    console.error('Erro:', error);
                    document.getElementById('tradingSignal').textContent = 'ERRO ⚠️';
                });
        }
        
        function updateDisplay(data) {
            // Atualizar preço
            const currentPrice = document.getElementById('currentPrice');
            currentPrice.textContent = '$' + data.current_price.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
            
            // Atualizar variação
            const changeElem = document.getElementById('priceChange');
            if (data.change >= 0) {
                changeElem.innerHTML = `<span class="positive">+$${Math.abs(data.change).toFixed(2)} (${Math.abs(data.change_percent).toFixed(2)}%)</span>`;
            } else {
                changeElem.innerHTML = `<span class="negative">-$${Math.abs(data.change).toFixed(2)} (${Math.abs(data.change_percent).toFixed(2)}%)</span>`;
            }
            
            // Atualizar sinal
            const signalElem = document.getElementById('tradingSignal');
            signalElem.innerHTML = data.signal;
            signalElem.className = `signal-${data.signal.toLowerCase().split(' ')[0]}`;
            
            // Atualizar análise
            document.getElementById('analysisText').innerHTML = data.analysis;
            
            // Atualizar confiança
            const confidenceBar = document.getElementById('confidenceBar');
            const confidenceText = document.getElementById('confidenceText');
            confidenceBar.style.width = data.confidence + '%';
            confidenceText.textContent = data.confidence + '%';
            
            // Atualizar gráficos
            if (data.candle_graph) {
                const candleGraph = JSON.parse(data.candle_graph);
                Plotly.newPlot('candleChart', candleGraph.data, candleGraph.layout, {
                    responsive: true,
                    displayModeBar: true,
                    displaylogo: false
                });
            }
            
            if (data.rsi_graph) {
                const rsiGraph = JSON.parse(data.rsi_graph);
                Plotly.newPlot('rsiChart', rsiGraph.data, rsiGraph.layout, {
                    responsive: true,
                    displayModeBar: true,
                    displaylogo: false
                });
            }
            
            // Atualizar outras informações
            document.getElementById('rsiValue').textContent = data.rsi;
            document.getElementById('lastUpdate').textContent = data.last_update;
        }
        
        // Carregar dados inicialmente e a cada 30 segundos
        loadData();
        setInterval(loadData, 30000);
        
        // Efeito de terminal
        document.addEventListener('DOMContentLoaded', function() {
            const elements = document.querySelectorAll('.chart-container');
            elements.forEach((el, index) => {
                setTimeout(() => {
                    el.style.opacity = '1';
                    el.style.transform = 'translateY(0)';
                }, index * 200);
            });
        });
    </script>
</body>
</html>